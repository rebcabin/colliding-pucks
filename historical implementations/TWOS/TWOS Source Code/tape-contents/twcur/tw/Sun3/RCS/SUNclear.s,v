head     1.4;
branch   ;
access   ;
symbols  TW2_6:1.4 TW2_5_1:1.3 TW2_4_2:1.2 TW2_4_1:1.1 TW2_4:1.1;
locks    ; strict;
comment  @| @;


1.4
date     91.11.01.13.40.32;  author pls;  state Rel;
branches ;
next     1.3;

1.3
date     91.07.17.15.59.11;  author judy;  state Rel;
branches ;
next     1.2;

1.2
date     90.12.10.11.43.35;  author configtw;  state Rel;
branches ;
next     1.1;

1.1
date     90.08.07.11.12.50;  author configtw;  state Rel;
branches ;
next     ;


desc
@Fast clear for Sun 3
@


1.4
log
@Handle 64K boundary condtion.
@
text
@|
|	Copyright (C) 1989, 1991, California Institute of Technology.
|	U. S. Government Sponsorship under NASA Contract NAS7-918
|	is acknowledged.
|
| $Log:	SUNclear.s,v $
| Revision 1.3  91/07/17  15:59:11  judy
| New copyright notice.
| 
| Revision 1.2  90/12/10  11:43:35  configtw
| fix 16 bit loop problem
| 
| Revision 1.1  90/08/07  11:12:50  configtw
| Initial revision
| 

|	clear ( addr, numbytes )

	.text
	.globl	_clear
_clear:
	link	a6,#0
	movl	a6@@(8),a0	| addr
	movl	a6@@(12),d0	| numbytes
	movl	d2,a7@@-
	movl	d1,a7@@-
	movl	#3,d1
	bras	g1
l1:
	clrb	a0@@+
g1:
	movl	a0,d2
	andl	d1,d2
	dbeq	d0,l1
	beqs	notdone2
	swap	d0			| check high 16 bits
	dbf		d0,notdone1
	bras	done
notdone1:				| count > 16 bits
	swap	d0			| swap count back
	andl	d0,d1		| save low order 2 bits of count
	lsrl	#2,d0		| convert to word count
	bras	l2			| start loop with write
notdone2:
	andl	d0,d1
	lsrl	#2,d0
	bras	g2
l20:
	swap	d0			| get low 16 bits again
l2:
	clrl	a0@@+
g2:
	dbf		d0,l2
	swap	d0			| look at high 16 bits
	dbf		d0,l20
	bras	g3
l3:
	clrb	a0@@+
g3:
	dbf		d1,l3

done:
	movl	a7@@+,d1
	movl	a7@@+,d2
	unlk	a6
	rts
@


1.3
log
@New copyright notice.
@
text
@d7 3
d29 4
a32 2
l1:	clrb	a0@@+
g1:	movl	a0,d2
d35 10
a44 1
	bnes	done
d48 8
a55 3
l2:	clrl	a0@@+
g2:	subql	#1,d0
	bges	l2
d57 4
a60 2
l3:	clrb	a0@@+
g3:	dbf	d1,l3
d62 2
a63 1
done:	movl	a7@@+,d1
@


1.2
log
@fix 16 bit loop problem
@
text
@d2 4
d7 3
a12 4
|
|	Copyright (C) 1989, California Institute of Technology.
|	U. S. Government Sponsorship under NASA Contract NAS7-918
|	is acknowledged.
@


1.1
log
@Initial revision
@
text
@d2 4
a5 1
| $Log$
d32 2
a33 1
g2:	dbf	d0,l2
@
